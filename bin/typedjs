#!/usr/bin/env node
var typedjs = require('../lib/');
var util = require('util');
var fs = require('fs');
var files = process.argv.slice(2);

var extract = false;
files = files.filter(function (args) {
  extract = (args === '--extract' || args === '-e');
  return !extract;
});

function run(tests, file) {
  var result;

  try {
    result = tests.run();
  } catch (e) {
    result = false;
  }

  util.puts(file + ': ' + (result ? '✓' : '✘'));
}

function parseFiles(file) {
  var stat;
  try {
    stat = fs.statSync(file);
  } catch (e) {
    if (e.code === 'ENOENT') {
      util.puts(file + ' not found.');
      return false;
    }
    throw e;
  }

  if (!stat.isFile()) {
    util.puts(file + ' is not a file.');
    return false;
  }

  var code = fs.readFileSync(file).toString();
  var tests = typedjs.createTests(code, extract);

  run(tests, file);
}

files.forEach(parseFiles);
